import { improvePromptWithN8n } from '../src/lib/n8n';
import * as dotenv from 'dotenv';
import path from 'path';

// Load .env from project root
dotenv.config({ path: path.resolve(__dirname, '../.env') });

async function main() {
    console.log("üöÄ Starting manual N8N test...");
    console.log("N8N_PROMPT_WEBHOOK_URL:", process.env.N8N_PROMPT_WEBHOOK_URL);

    const prompt = "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏™‡∏ö‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå. ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ‡∏°‡∏≤‡∏°‡∏µ‡πà‡πÇ‡∏û‡πÇ‡∏Ñ ‡πÅ‡∏û‡πâ‡∏ô‡∏ó‡πå ‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡πà‡∏¢‡∏° ‡πÄ‡∏≠‡∏° ‡πÄ‡∏û‡∏≠‡∏£‡πå‡πÄ‡∏ü‡∏Ñ‡∏ï‡πå ‡∏î‡∏£‡∏≤‡∏¢. - ‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡∏µ‡∏¢‡∏Å‡∏ä‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏∑‡πà‡∏ô‡∏ú‡πâ‡∏≤‡∏≠‡πâ‡∏≠‡∏° ‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÅ‡∏´‡πâ‡∏á‡∏™‡∏ö‡∏≤‡∏¢\n- ‡∏ã‡∏∂‡∏°‡∏ã‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏™‡∏•‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏ñ‡∏∂‡∏á 6 ‡πÅ‡∏Å‡πâ‡∏ß ‡∏´‡∏£‡∏∑‡∏≠ ‡∏¢‡∏≤‡∏ß‡∏ô‡∏≤‡∏ô 12 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á*** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏û‡πà‡∏≠‡πÄ‡πÄ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß. ‡∏™‡πÑ‡∏ï‡∏•‡πå: ‡πÇ‡∏°‡πÄ‡∏î‡∏¥‡∏£‡πå‡∏ô ‡∏•‡∏¥‡∏™‡∏ï‡πå ‡∏™‡∏î‡πÉ‡∏™ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö TikTok.";
    const product = {
        name: "‡∏°‡∏≤‡∏°‡∏µ‡πà‡πÇ‡∏û‡πÇ‡∏Ñ ‡πÅ‡∏û‡πâ‡∏ô‡∏ó‡πå ‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡πà‡∏¢‡∏° ‡πÄ‡∏≠‡∏° ‡πÄ‡∏û‡∏≠‡∏£‡πå‡πÄ‡∏ü‡∏Ñ‡∏ï‡πå ‡∏î‡∏£‡∏≤‡∏¢",
        features: "- ‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡∏µ‡∏¢‡∏Å‡∏ä‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏∑‡πà‡∏ô‡∏ú‡πâ‡∏≤‡∏≠‡πâ‡∏≠‡∏° ‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÅ‡∏´‡πâ‡∏á‡∏™‡∏ö‡∏≤‡∏¢\n- ‡∏ã‡∏∂‡∏°‡∏ã‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏™‡∏•‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏ñ‡∏∂‡∏á 6 ‡πÅ‡∏Å‡πâ‡∏ß ‡∏´‡∏£‡∏∑‡∏≠ ‡∏¢‡∏≤‡∏ß‡∏ô‡∏≤‡∏ô 12 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á***",
        concept: "lifestyle",
        targetAudience: "parents",
        imageUrls: ["https://images.mango-prod.siammakro.cloud/SOURCE/1bbad246d6b64fd38f758855d62fcdfe?eo-img.resize=w%2F1080&eo-img.format=webp"]
    };

    console.log("\nüì° Calling improvePromptWithN8n with:", product.imageUrls);
    try {
        const result = await improvePromptWithN8n(prompt, product, product.imageUrls);
        console.log("\n‚úÖ Result from N8N:", result);
    } catch (error) {
        console.error("\n‚ùå Error during test:", error);
    }
}

main();
